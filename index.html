<script>
    const wheelNumbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    const reds = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
    let history = [];
    let counts = {};
    for(let i=0; i<=36; i++) counts[i] = 0;
    let currentDeg = 0;

    function spinWheel() {
        const btn = document.getElementById('spin-btn');
        const ball = document.getElementById('ball');
        const wheel = document.getElementById('svg-wheel');
        
        btn.disabled = true;
        document.getElementById('result').innerText = "...";

        // 1. Pehle Result decide karo
        const winIdx = Math.floor(Math.random() * 37);
        const winNum = wheelNumbers[winIdx];

        // 2. Wheel Rotation (Clockwise)
        const sliceA = 360 / 37;
        const targetWheelA = (360 - (winIdx * sliceA)) % 360;
        const wheelSpins = (4 + Math.floor(Math.random() * 2)) * 360;
        currentDeg += wheelSpins + (targetWheelA - (currentDeg % 360));
        wheel.style.transform = `rotate(${currentDeg}deg)`;

        // 3. Ball Rotation (Anti-Clockwise & Independent)
        ball.style.display = "block";
        const ballSpins = (6 + Math.floor(Math.random() * 2)) * 360;
        
        // YE HAI MAIN LOGIC: 
        // Ball ko itna ghumao ki wo wheel ke target angle ke exact opposite land kare
        const totalBallRot = -(ballSpins + (360 - targetWheelA));

        ball.animate([
            { transform: `translate(-50%, -50%) rotate(0deg) translateY(-135px)` },
            { transform: `translate(-50%, -50%) rotate(${totalBallRot}deg) translateY(-98px)` }
        ], {
            duration: 4000,
            easing: 'cubic-bezier(0.1, 0, 0.1, 1)', // Smooth slow down
            fill: 'forwards'
        });

        setTimeout(() => {
            updateData(winNum);
            btn.disabled = false;
        }, 4000);
    }

    function updateData(n) {
        history.unshift(n);
        counts[n]++;
        const r = document.getElementById('result');
        r.innerText = n;
        r.className = "result-display " + (n===0?'bg-green':(reds.includes(n)?'bg-red':'bg-black'));
        
        // Percentages & History
        const total = history.length;
        document.getElementById('red-pct').innerText = Math.round((history.filter(x=>reds.includes(x)).length/total)*100) + "%";
        document.getElementById('black-pct').innerText = Math.round((history.filter(x=>x!==0 && !reds.includes(x)).length/total)*100) + "%";
        document.getElementById('total-spins').innerText = total;

        const ballHtml = (num) => `<div class="tiny-ball ${num===0?'bg-green':(reds.includes(num)?'bg-red':'bg-black')}">${num}</div>`;
        document.getElementById('history-div').innerHTML = history.slice(0,10).map(ballHtml).join('');
        
        // TOP 5 HOT & COLD
        document.getElementById('hot-div').innerHTML = Object.keys(counts).sort((a,b)=>counts[b]-counts[a]).slice(0,5).filter(x=>counts[x]>0).map(x=>ballHtml(parseInt(x))).join('');
        let cold = [];
        for(let i=0; i<=36; i++) if(!history.slice(0,15).includes(i)) cold.push(i);
        document.getElementById('cold-div').innerHTML = cold.slice(0,5).map(ballHtml).join('');
    }
</script>
